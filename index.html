<!DOCTYPE html>
<html>
  <head>
    <title>Web Design Exam</title>
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css"
    />
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <style>
      th {
        color: darkslategrey;
        padding: 8px;
      }

      td {
        padding: 6px;
        border-bottom: 1px solid #ddd;
      }
      /* Estilo del t√≠tulo del di√°logo */
    .ui-dialog-titlebar {
       background: #2c3e50;   /* Color de fondo */
       color: white;          /* Texto blanco */
       font-weight: bold;
       border: none;
       border-radius: 6px 6px 0 0;
       padding: 8px 12px;
    }
/* Aseguramos que el icono de cierre se vea bien */
.ui-dialog .ui-dialog-titlebar-close .ui-icon {
    background-image: none; /* Quitamos la imagen por defecto */
    display: block;
    text-align: center;
    line-height: 1;
    font-size: 18px;
}

/* Ponemos la cruz */
.ui-dialog .ui-dialog-titlebar-close::before {
    content: "‚úñ"; /* Cruz */
    color: white;
    font-size: 18px;
    font-weight: bold;
}

.ui-dialog .ui-dialog-titlebar-close:hover::before {
    color: #e74c3c; /* Rojo al pasar el mouse */
}
/* Bot√≥n de cerrar (la cruz) */
    .ui-dialog-titlebar-close {
        background: transparent;
        border: none;
        color: white;
       font-size: 16px;
       font-weight: bold;
       margin-right: 6px;
       cursor: pointer;
    }

    .ui-dialog-titlebar-close:hover {
        color: #e74c3c; /* Rojo al pasar el mouse */
    }

      button {
        padding: 5px 10px;
        border: none;
        cursor: pointer;
        border-radius: 4px;
      }

      .btn-edit {
        background-color: #63d165;
        color: white;
      }

      .btn-remove {
        background-color: #b6382f;
        color: white;
      }

      /* üîπ Estilos extra para el popup */
      #popUp table td {
        padding: 6px;
      }

      #popUp input {
        width: 100%;
        padding: 4px;
        box-sizing: border-box;
      }

      #id[readonly] {
        background: #f0f0f0;
        cursor: not-allowed;
        
      }
    </style>
  </head>
  <body>
    <table style="border: 1px solid; border-collapse: collapse; width: 100%"></table>

    <div id="popUp" title="Web Design Exam" style="overflow-x: hidden">
      <table>
        <tr>
          <td>albumId:</td>
          <td><input type="text" id="albumId" /></td>
        </tr>
        <tr>
          <td>id:</td>
          <!-- üîπ Ahora es de solo lectura -->
          <td><input type="text" id="id" readonly /></td>
        </tr>
        <tr>
          <td>title:</td>
          <td><input type="text" id="title" /></td>
        </tr>
        <tr>
          <td>url:</td>
          <td><input type="text" id="url" /></td>
        </tr>
        <tr>
          <td>thumbnailUrl:</td>
          <td><input type="text" id="thumbnailUrl" /></td>
        </tr>
      </table>
    </div>

    <script>
      const url = "https://jsonplaceholder.typicode.com/photos";
      let currentObject = null;

      // üîπ Nuevo: array local para reflejar cambios
      let objectsData = [];

      window.onload = function () {
        loadObjects();

        $("#popUp").dialog({
          autoOpen: false,
          modal: true,
          width: 400,
          buttons: {
            Guardar: function () {
              if (currentObject) {
                updateObject();
              } else {
                saveObject();
              }
            },
            Cancelar: function () {
              $(this).dialog("close");
            },
          },
        });
      };

      function loadObjects() {
        fetch(url)
          .then((response) => response.json())
          .then((data) => {
            // üîπ Guardamos los datos en el array local
            objectsData = data.slice(0, 10); // cargo solo 10 para que no sea gigante
            displayData(objectsData);
          })
          .catch((error) => console.error("Error loading:", error));
      }

      function saveObject() {
        const newObject = {
          albumId: $("#albumId").val(),
          id: Date.now(), // üîπ Generamos un id √∫nico local
          title: $("#title").val(),
          url: $("#url").val(),
          thumbnailUrl: $("#thumbnailUrl").val(),
        };

        // üîπ Lo agregamos al array local
        objectsData.push(newObject);

        $("#popUp").dialog("close");
        displayData(objectsData);
      }

      function deleteObject(id) {
        if (confirm("Are you sure you want to delete?")) {
          // üîπ Eliminamos del array local
          objectsData = objectsData.filter((obj) => obj.id !== id);
          displayData(objectsData);
        }
      }

      function updateObject() {
        const updatedObject = {
          id: currentObject.id,
          albumId: $("#albumId").val(),
          title: $("#title").val(),
          url: $("#url").val(),
          thumbnailUrl: $("#thumbnailUrl").val(),
        };

        // üîπ Actualizamos el array local
        objectsData = objectsData.map((obj) =>
          obj.id === currentObject.id ? updatedObject : obj
        );

        $("#popUp").dialog("close");
        currentObject = null;
        displayData(objectsData);
      }

      function displayData(data) {
        const table = $("table:first");
        table.empty();
        table.append(`
          <thead>
            <tr>
              <th>AlbumId</th>
              <th>Id</th>
              <th>Title</th>
              <th>Url</th>
              <th>ThumbnailUrl</th>
              <th>Edit</th>
              <th>Remove</th>
            </tr>
          </thead>
          <tbody></tbody>
        `);

        data.forEach((user) => {
          table.find("tbody").append(`
            <tr>
              <td>${user.albumId}</td>
              <td>${user.id}</td>
              <td>${user.title}</td>
              <td>${user.url}</td>
              <td>${user.thumbnailUrl}</td>
              <td><button class="btn-edit" onclick="editUser(${user.id})">Edit</button></td>
              <td><button class="btn-remove" onclick="deleteObject(${user.id})">Remove</button></td>
            </tr>
          `);
        });

        if ($("#addButton").length === 0) {
          table.after('<button id="addButton">Add New</button>');
          $("#addButton").click(openPopupForAdd);
        }
      }

      function openPopupForAdd() {
        currentObject = null;
        $("#albumId").val("");
        $("#id").val("");
        $("#title").val("");
        $("#url").val("");
        $("#thumbnailUrl").val("");
        $("#popUp").dialog("open");
      }

      function editUser(id) {
        // üîπ Buscamos el objeto en el array local en vez de pedirlo a la API
        const user = objectsData.find((obj) => obj.id === id);
        if (user) {
          currentObject = user;
          $("#albumId").val(user.albumId);
          $("#id").val(user.id);
          $("#title").val(user.title);
          $("#url").val(user.url);
          $("#thumbnailUrl").val(user.thumbnailUrl);
          $("#popUp").dialog("open");
        }
      }
    </script>
  </body>
</html>
